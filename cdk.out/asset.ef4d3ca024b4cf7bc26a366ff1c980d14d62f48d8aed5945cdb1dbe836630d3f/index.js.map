{
  "version": 3,
  "sources": ["../asset-input/src/functions/auth/define-auth-challenge/index.ts"],
  "sourcesContent": ["import { DefineAuthChallengeTriggerHandler } from 'aws-lambda';\n\ninterface ChallengeSession {\n    challengeName: string;\n    challengeResult: boolean;\n}\n\ninterface AuthEvent {\n    request: {\n        userNotFound?: boolean;\n        session: ChallengeSession[];\n    };\n    response: AuthResponse;\n}\n\ninterface AuthResponse {\n    isValid?: boolean;\n    challengeName?: string;\n    issueTokens: boolean;\n    failAuthentication: boolean;\n}\n\nexport const handler: DefineAuthChallengeTriggerHandler = async (event) => {\n    const { request } = event;\n    \n    // If user is not found, fail\n    if (request.userNotFound) {\n        event.response = {\n            failAuthentication: true,\n            issueTokens: false\n        };\n        return event;\n    }\n\n    // Initialize session if undefined\n    if (!request.session) {\n        request.session = [];\n    }\n\n    if (request.session.length === 0) {\n        // First challenge\n        event.response.challengeName = 'CUSTOM_CHALLENGE';\n        event.response.issueTokens = false;\n        event.response.failAuthentication = false;\n    } else if (request.session.length === 1 && request.session[0].challengeName === 'CUSTOM_CHALLENGE') {\n        // Verify the OTP\n        if (request.session[0].challengeResult === true) {\n            event.response.issueTokens = true;\n            event.response.failAuthentication = false;\n        } else {\n            event.response.issueTokens = false;\n            event.response.failAuthentication = true;\n        }\n    } else {\n        // Fail auth for all other cases\n        event.response.issueTokens = false;\n        event.response.failAuthentication = true;\n    }\n\n    return event;\n};"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAsBO,IAAME,EAA6C,MAAOE,GAAU,CACvE,GAAM,CAAE,QAAAC,CAAQ,EAAID,EAGpB,OAAIC,EAAQ,cACRD,EAAM,SAAW,CACb,mBAAoB,GACpB,YAAa,EACjB,EACOA,IAINC,EAAQ,UACTA,EAAQ,QAAU,CAAC,GAGnBA,EAAQ,QAAQ,SAAW,GAE3BD,EAAM,SAAS,cAAgB,mBAC/BA,EAAM,SAAS,YAAc,GAC7BA,EAAM,SAAS,mBAAqB,IAC7BC,EAAQ,QAAQ,SAAW,GAAKA,EAAQ,QAAQ,CAAC,EAAE,gBAAkB,oBAExEA,EAAQ,QAAQ,CAAC,EAAE,kBAAoB,IACvCD,EAAM,SAAS,YAAc,GAC7BA,EAAM,SAAS,mBAAqB,KAOxCA,EAAM,SAAS,YAAc,GAC7BA,EAAM,SAAS,mBAAqB,IAGjCA,EACX",
  "names": ["define_auth_challenge_exports", "__export", "handler", "__toCommonJS", "event", "request"]
}
